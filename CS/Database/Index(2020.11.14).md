# Index(2020.11.14)
## Index란?
인덱스의 원래 뜻은 색인, 데이터베이스에서 조회 및 검색을 더 빠르게 할 수 있는 방법/기술,  혹은 이에 쓰이는 자료구조 자체를 의미한다.  DBMS도 데이터베이스 테이블의 모든 데이터를 검색해서 원하는 결과를 가져오려면 시간이 오래 걸린다. 그래서 칼럼의 값과 해당 레코드가 저장된 주소를 키와 값의 쌍으로 인덱스를 만들어 두는 것이다. 

DBMS의 인덱스는 항상 정렬된 상태를 유지하기 때문에 원하는 값을 탐색하는데는 빠르지만 새로운 값을 추가하거나 삭제, 수정하는 경우에는 쿼리문 실행 속도가 느려진다. 결론적으로 DBMS에서 인덱스는 데이터의 저장 성능을 희생하고 그 대신 데이터의 읽기 속도를 높이는 기능이다. SELECT 쿼리 문장의 WHERE 조건절에 사용되는 칼럼이라고 전부 인덱스를 생성하면 데이터 저장 성능이 떨어지고 인덱스의 크기가 비대해져 오히려 역효과만 불러올 수 있다. 

## Index 자료구조 
> DBMS는 인덱스를 어떻게 관리하고 있는가 

### B+- Tree 인덱스 알고리즘 
일반적으로 사용되는 인덱스 알고리즘은 B+- Tree 알고리즘이다. B+- Tree 인덱스는 칼럼의 값을 변형하지 않고(값의 앞부분만 잘라서 관리한다.), 원래의 값을 이용해 인덱싱하는 알고리즘이다. 

### Hash 인덱스 알고리즘
칼럼의 값으로 해시 값을 계산해서 인덱싱하는 알고리즘으로 매우 빠른 검색을 지원한다. 하지만 값을 변형해서 인덱싱하므로, 특정 문자로 시작하는 값으로 검색을 하는 등 전방 일치와 같이 값의 일부만으로 검색하고자 할 때는 해시 인덱스를 사용할 수 없다. 주로 메모리 기반의 데이터베이스에서 많이 사용한다. 

### Index를 생성하는데 b-tree 사용하는 이유
데이터에 접근하는 시간 복잡도가 O(1)인 Hash table이 더 효율적으로 보이지만 SELECT 질의의 조건에는 부등호 연산도 포함이다. hash table을 사용하면 등호 연산이 아닌 부등호 연산의 경우에 문제가 발생한다. 등호 연산에 특화된 hash table은 데이터베이스의 자료구조로 적합하지 않다. 

## Composite Index
인덱스로 설정하는 필드의 속성이 중요하다. title, author 이 순서로 인덱스를 설정한다면 title을 search 하는 경우, index를 생성한 것이 소용이 없어진다. 따라서 SELECT 질의를 어떻게 할 것인가가 인덱스를 어떻게 생성할 것인다에 대해 많은 영향을 끼치게 된다. 

## Index 성능과 고려사항

SELECT 쿼리의 성능을 월등히 향상시키는 Index는 항상 좋은 것일까? 그렇다면 모든 칼럼에 대해서 Index를 생성해두면 빨라지지 않을까? 결론은 *그렇지 않다.* 첫번째 이유는 Index를 생성하게 되면 INSERT, DELETE, UPDATE 쿼리문을 실행할 때 별도의 과정이 추가적으로 발생한다. INSERT의 경우 Index에 대한 데이터도 추가해야 하므로 그만큼 성능에 손실이 따른다. DELETE의 경우 Index에 존재하는 값은 삭제하지 않고 사용 안한다는 표시로 남게 된다. 즉 row의 수는 그대로인 것이다. 

이 작업이 반복된다면 실제 데이터는 10만건인데 데이터가 100만건 있는 결과를 낳을 수도 있다. 이렇게 되면 인덱스는 더 이상 제 역할을 못하게 된다. UPDATE의 경우는 INSERT의 경우, DELETE의 경우의 문제점을 동시에 수반한다. 이전 데이터가 삭제되고 그 자리에 새 데이터가 들어오는 개념이기 떄문이다. 변경 전 데이터는 삭제되지 않고, insert로 인한 split도 발생하게 된다. 

하지만 더 중요한 것은 칼럼을 이루고 있는 데이터의 형식에 따라서 인덱스의 성능이 악영향을 미칠 수 있다는 것이다. 즉, 데이터의 형식에 따라 인덱스를 만들면 효율적이고, 또는 비효율적인 데이터 형식이 존재하는 것이다.

예를 들어 `이름`, `나이`, `성별` 세가지의 필드를 갖고 있는 데이블을 생각해보자. 이름은 많은 경우의 수가 존재할 것이고, 나이는 INT 타입을 갖을 것이고, 성별은 남/녀 두가지 경우에 대해서만 데이터가 존재할 것을 예상할 수 있다. 이 경우 어떤 칼럼에 대해서 인덱스를 생성하는 것이 효율적일까? 결론부터 말하자면 이름에 대해서만 인덱스를 생성하면 효율적이다.

왜 성별이나 나이는 인덱스를 생성하면 비효율적일까? 10000 레코드에 해당하는 테이블에 대해서 2000 단위로 성별에 인덱스를 생성했다고 가정하자. 값의 range가 적은 성별은 인덱스를 읽고 다시 한 번 디스크 I/O가 발생하기 때문에 그 만큼 비효율적인 것이다.  